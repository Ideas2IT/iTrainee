@model iTrainee.Models.Batch;
@using Microsoft.AspNetCore.Mvc.Rendering;

<style>
	.hidden{
		display: none;
	}

	.show{
		display:block;
	}

	.submit-button{
		width:5rem;
	}

	.submit-button:hover{
		cursor:pointer;
	}
</style>

@{
	ViewData["Title"] = "AddEditBatch";
	
}
<h3 class="mt-5 mb-4">Save Batch</h3>

<div>
<form id="batchForm" method="post">
	@Html.AntiForgeryToken()

	<div class="form-group">
		<input value="@Model.Id" name="Id" type="hidden" />
	</div>

	
	<div class="form-group">
		<label class="col-form-label">Name</label>
		<input type="text" class="form-control" id="batchName" name="Name" value="@Model.Name" autocomplete="off"/>
		
		<label id="batchNameError" class="hidden text-danger">Please enter batch name</label>
	</div>

	<div class="form-group">
		<label class="col-form-label">Mentors</label><br />
		@Html.ListBoxFor(model=>model.SelectedMentorIds, new MultiSelectList(Model.MentorList, "Id", "UserName"),  htmlAttributes: new { id="SelectedMentorIds", @class = "form-control", multiple="multiple" })
		<label id="mentorError" class="hidden text-danger">Please select atleast one mentor</label>
	</div>

	<div class="form-group">
		<label class="col-form-label">Trainees</label><br />
		@Html.ListBoxFor(model=>model.SelectedTraineeIds ,new MultiSelectList(Model.TraineeList, "Id", "UserName"),  htmlAttributes: new { id="SelectedTraineeIds", @class = "form-control", multiple="multiple" })
		<label id="traineeError" class="hidden text-danger">Please select atleast one trainee</label>
	</div>

	<div class="form-group">
		<label class="col-form-label">Streams</label><br />
		@Html.ListBoxFor(model=>model.SelectedStreamIds ,new SelectList(Model.StreamList, "Id", "Name"),  htmlAttributes: new { id="SelectedStreamIds", @class = "form-control", multiple="multiple" })
		<label id="streamError" class="hidden text-danger">Please select atleast one stream</label>
	</div>
	<div class="text-right mb-3">
		<input id="batchSubmitBtn" type="button" class="mt-3 btn btn-primary submit-button" value="Save" />
	</div>
	
</form>
</div>

@section scripts{

<script type="text/javascript">

	$(function(){
		$("#SelectedTraineeIds").chosen({
			placeholder_text_multiple: "Select minimum one trainee"
		});
		$("#SelectedStreamIds").chosen({
			placeholder_text_multiple: "Select minimum one stream"
		});  
        $("#SelectedMentorIds").chosen({
            placeholder_text_multiple: "Select minimum one mentor"
        });

		$("#batchSubmitBtn").click(function () {
			debugger;
			var mentorCount = $("#SelectedMentorIds option:selected").length;
			var traineeCount = $("#SelectedTraineeIds option:selected").length;
			var streamCount = $("#SelectedStreamIds option:selected").length;
			var batchName = document.getElementById('batchName').value;

			if(mentorCount == 0){
				$('#mentorError').removeClass("hidden");
				$('#mentorError').addClass("show");
			} 
			if(traineeCount == 0) {
				$('#traineeError').removeClass("hidden");
				$('#traineeError').addClass("show");
			} 
			if(streamCount == 0) {
				$('#streamError').removeClass("hidden");
				$('#streamError').addClass("show");
			} 
			if(batchName == "") {
				$('#batchNameError').removeClass("hidden");
				$('#batchNameError').addClass("show");
			} 
			if(mentorCount != 0 && traineeCount != 0 && streamCount != 0 && batchName != "") {
				var a = $("#batchForm").serialize();
				$.ajax({
					type: "POST",
					url: "/Shared/Batch/AddEditBatch",
					data: a,
					dataType: "json",
					success: function (result) {
						window.location.href = "/Shared/Batch/ManageBatch"
					},
					error: function () {
						alert("Unable to save/update data");
					},
				});
			}
		});
	});


</script>

}
